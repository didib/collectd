From cf065bc814b6aa766ee1106dc18b7b64d1fabd66 Mon Sep 17 00:00:00 2001
From: Ruben Kerkhof <ruben@rubenkerkhof.com>
Date: Sat, 5 Dec 2015 13:21:25 +0100
Subject: [PATCH 08/14] varnish plugin: fix two resource leaks on error

CID #42774

Signed-off-by: Florian Forster <octo@collectd.org>
(cherry picked from commit ce65e9a3072aff269b2caf29e7f1450a10882aba)
---
 src/varnish.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/varnish.c b/src/varnish.c
index 682e362..a138d18 100644
--- a/src/varnish.c
+++ b/src/varnish.c
@@ -1000,6 +1000,7 @@ static int varnish_config_instance (const oconfig_item_t *ci) /* {{{ */
 	{
 		WARNING ("Varnish plugin: \"Instance\" blocks accept only "
 				"one argument.");
+		sfree (conf);
 		return (EINVAL);
 	}
 
@@ -1107,6 +1108,7 @@ static int varnish_config_instance (const oconfig_item_t *ci) /* {{{ */
 		WARNING ("Varnish plugin: No metric has been configured for "
 				"instance \"%s\". Disabling this instance.",
 				(conf->instance == NULL) ? "localhost" : conf->instance);
+		sfree (conf);
 		return (EINVAL);
 	}
 
-- 
2.5.0

